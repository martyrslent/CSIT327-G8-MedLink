{% extends 'admin_dashboard.html' %}
{% load static %}

{% block title %}Manage Appointments{% endblock %}

{% block style %}
<style>
    .appointment-table-container { 
        background-color: white; 
        padding: 20px; 
        border-radius: 8px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
        margin-bottom: 30px;
    }

    table { 
        width: 100%; 
        border-collapse: collapse; 
        margin-top: 20px; 
    }

    th, td { 
        padding: 12px 15px; 
        text-align: left; 
        border-bottom: 1px solid #ddd; 
    }

    th { 
        background-color: #f2f2f2; 
        color: #333; 
        font-weight: bold; 
    }

    tr:hover { 
        background-color: #f5f5f5; 
    }

    .action-buttons a, .action-buttons button { 
        margin-right: 5px; 
        padding: 6px 12px; 
        border-radius: 4px; 
        text-decoration: none; 
        color: white; 
        font-size: 0.9em; 
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .edit-btn { background-color: #3498db; }
    .edit-btn:hover { background-color: #2980b9; }

    .delete-btn { background-color: #e74c3c; }
    .delete-btn:hover { background-color: #c0392b; }

    .complete-btn { background-color: #2ecc71; }
    .complete-btn:hover { background-color: #27ae60; }

    .status-completed {
        color: #155724;
        background-color: #d4edda;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: 600;
        font-size: 0.85em;
        display: inline-block;
    }

    .status-pending {
        color: #856404;
        background-color: #fff3cd;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: 600;
        font-size: 0.85em;
        display: inline-block;
    }
</style>
{% endblock %}

{% block content %}
<div class="header">
    <h1>Manage Appointments</h1>
    <a href="{% url 'register_appointment' %}" class="btn btn-primary">Book New Appointment</a>
</div>

{% if messages %}
    {% for message in messages %}
        <p class="messages {{ message.tags }}" style="padding: 10px; border-radius: 5px; margin-bottom: 15px; 
           {% if message.tags == 'error' %}background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
           {% elif message.tags == 'success' %}background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;
           {% elif message.tags == 'warning' %}background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;
           {% endif %}">{{ message }}</p>
    {% endfor %}
{% endif %}

<!-- Pending Appointments -->
<div class="appointment-table-container">
    <h3>Pending Appointment Approval</h3>
    {% if appointments %}
    <table>
        <thead>
            <tr>
                <th>#ID</th>
                <th>Patient Name</th>
                <th>Doctor Name</th> 
                <th>Patient Email</th> 
                <th>Appointment Date</th>
                <th>Status</th> 
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
                {% if appointment.status == "Pending" %}
                <tr>
                    <td>{{ appointment.id }}</td>
                    <td>{{ appointment.first_name }} {{ appointment.last_name }}</td>
                    <td>{{ appointment.doctor_name }}</td> 
                    <td>{{ appointment.user_email }}</td> 
                    <td>{{ appointment.appointment_date }}</td>
                    <td><span class="status-pending">Pending</span></td>
                    <td class="action-buttons">
                        <form action="{% url 'approve_appointment' appointment.id %}" method="post" style="display:inline;" onsubmit="return confirm('Approve this appointment?');">
                            {% csrf_token %}
                            <button type="submit" class="complete-btn">Approve</button>
                        </form>
                        <a href="{% url 'edit_appointment' appointment.id %}" class="edit-btn">Edit</a>
                        <form action="{% url 'delete_appointment' appointment.id %}" method="post" style="display:inline;" onsubmit="return confirm('Delete this appointment?');">
                            {% csrf_token %}
                            <button type="submit" class="delete-btn">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No pending appointments.</p>
    {% endif %}
</div>

<!-- Approved Appointments -->
<div class="appointment-table-container">
    <h3>Approved Appointments</h3>
    {% if appointments %}
    <table>
        <thead>
            <tr>
                <th>#ID</th>
                <th>Patient Name</th>
                <th>Doctor Name</th> 
                <th>Patient Email</th> 
                <th>Appointment Date</th>
                <th>Status</th> 
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
                {% if appointment.status == "Approved" and not appointment.successful_appointment_visit %}
                <tr>
                    <td>{{ appointment.id }}</td>
                    <td>{{ appointment.first_name }} {{ appointment.last_name }}</td>
                    <td>{{ appointment.doctor_name }}</td> 
                    <td>{{ appointment.user_email }}</td> 
                    <td>{{ appointment.appointment_date }}</td>
                    <td><span class="status-completed">Approved</span></td>
                    <td class="action-buttons">
                        <a href="{% url 'edit_appointment' appointment.id %}" class="edit-btn">Edit</a>
                        <form action="{% url 'delete_appointment' appointment.id %}" method="post" style="display:inline;" onsubmit="return confirm('Delete this appointment?');">
                            {% csrf_token %}
                            <button type="submit" class="delete-btn">Delete</button>
                        </form>
                        <form action="{% url 'complete_appointment' appointment.id %}" method="post" style="display:inline;" onsubmit="return confirm('Mark this appointment as completed?');">
                            {% csrf_token %}
                            <button type="submit" class="complete-btn">Complete</button>
                        </form>
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No approved appointments.</p>
    {% endif %}
</div>
{% endblock %}
