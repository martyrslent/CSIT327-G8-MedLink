{% extends "admin_base.html" %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block style %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

/* Background & overlay */
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(-45deg, #ff5e00, #970000ff, #ad0505, #420b01);
    background-size: 400% 400%;
    animation: moveBg 12s ease infinite;
    background-attachment: fixed; /* Ensures the gradient moves smoothly */
    min-height: 100vh;
}
@keyframes moveBg {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.bg-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: url("{% static 'main/img/room2.png' %}") no-repeat center center;
    background-size: cover;
    opacity: 0.12;
    pointer-events: none;
    z-index: 0;
}

/* Top-right profile */
.top-right-profile {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: rgba(255,255,255,0.9);
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.20);
    z-index: 100;
}
.top-right-profile .role-text {
    font-size: 0.95rem;
    font-weight: 600;
    color: #444;
    text-transform: capitalize;
    font-family: 'Poppins', sans-serif;
}
.top-right-profile .profile-circle {
    width: 50px; height: 50px;
    border-radius: 50%;
    background: #ad0505;
    color: #fff;
    font-weight: 700;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    text-transform: uppercase;
    font-family: 'Poppins', sans-serif;
}

/* Sidebar */
.sidebar {
    position: fixed;
    top: 0; left: 0;
    height: 100%;
    width: 220px;
    background: #fff;
    padding: 30px 20px;
    display: flex;
    flex-direction: column;
    gap: 25px;
    border-right: 1px solid rgba(0,0,0,0.08);
    z-index: 2;
}
.sidebar::before {
    content: "";
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: url("{% static 'main/img/womandoctor.png' %}") no-repeat center center;
    background-size: cover;
    opacity: 0.28;
    pointer-events: none;
    z-index: 0;
}
.sidebar .logo img {
    width: 150px;
    display: block;
    margin: 0 auto 20px auto;
    position: relative;
    z-index: 1;
}
.sidebar nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.sidebar nav ul li a {
    display: block;
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 600;
    color: #fff;
    text-decoration: none;
    background: #ad0505;
    box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    transition: background 0.25s, transform 0.22s, box-shadow 0.25s;
    font-family: 'Poppins', sans-serif;
}
.sidebar nav ul li a:hover,
.sidebar nav ul li a:focus {
    background: linear-gradient(to right, #ff7b00, #d10000);
    transform: translateX(6px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
}
.sidebar nav ul li a.active {
    background: linear-gradient(to right, #d10000, #a30000);
    transform: translateX(3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

/* Main content */
.content {
    margin-left: 115px;
    padding: 20px 20px 36px 20px;
    position: relative;
    z-index: 2;
}
.page-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 12px;
    color: #fff;
    font-family: 'Poppins', sans-serif;
    display: flex;
    align-items: center;
    gap: 12px;
}
.status-tag {
    background: #8d0000b4;
    color: white;
    padding: 7px 13px;
    border-radius: 8px;
    font-size: 1.5rem;
    font-weight: 600;
}

/* Stat cards */
.top-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 18px;
    margin-bottom: 24px;
    margin-left: 4px;
}
.stat-card {
    background: #fff;
    border-radius: 14px;
    padding: 18px;
    text-align: center;
    color: #b10000;
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
    transition: transform 0.22s, box-shadow 0.22s;
    font-family: 'Poppins', sans-serif;
}
.stat-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.22);
}
.stat-card img.icon {
    width: 60px; height: 60px;
    margin: 0 auto 10px auto;
    border-radius: 12px;
    background: #fff;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
}
.stat-number { font-size: 28px; font-weight: 700; margin-top: 6px; font-family: 'Poppins', sans-serif; }
.stat-desc { font-size: 0.9rem; color: #6b6b6b; font-family: 'Poppins', sans-serif; }

/* Tables */
.wide-card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 26px;
    box-shadow: 0 10px 26px rgba(0,0,0,0.18);
    margin-left: 4px;
    font-family: 'Poppins', sans-serif;
}
.wide-card .header-row { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
.wide-card h3 { margin:0; font-size:1.05rem; font-family: 'Poppins', sans-serif; }

table {
    width: calc(100% - 4px);
    border-collapse: collapse;
    color: #222;
    font-size: 0.95rem;
    font-family: 'Poppins', sans-serif;
}
table th, table td { padding: 12px 10px; text-align:left; vertical-align: middle; font-family: 'Poppins', sans-serif; }
table thead th { border-bottom: 2px solid rgba(200,0,0,0.08); }
table tbody tr { transition: background 0.18s; }
table tbody tr:nth-child(odd) { background: rgba(245,245,245,0.92); }
table tbody tr:nth-child(even) { background: rgba(255,250,250,0.96); }
table tbody tr:hover { background: rgba(255,238,238,0.96); }

/* Buttons */
.btn-action {
    display:inline-block;
    padding:8px 12px;
    border-radius:10px;
    color:#fff !important;
    text-decoration:none !important;
    font-size:0.9rem;
    font-weight:700;
    box-shadow:0 6px 14px rgba(0,0,0,0.12);
    transition: transform 0.18s, box-shadow 0.18s;
    font-family: 'Poppins', sans-serif;
}
.btn-action:hover { transform: translateY(-3px); box-shadow:0 10px 22px rgba(0,0,0,0.14); }
.btn-approve { background: linear-gradient(90deg, #ff9a3d, #ff7b00); }
.btn-complete { background: linear-gradient(90deg, #34c38f, #0bb07a); }
.btn-manage { background: linear-gradient(90deg, #d83d00ff, #a30101ff); }

/* Responsive */
@media (max-width:900px) {
    .content { margin-left:0; padding:20px; }
    .top-row { grid-template-columns:1fr; }
    table { width:100%; }
}
</style>
{% endblock %}

{% block content %}
<div class="bg-overlay"></div>

<div class="top-right-profile">
    <div class="role-text">
        {{ request.session.role|default:"User"|title }}
    </div>
    <div class="profile-circle">
        {{ request.session.first_name|default:"X"|slice:":1" }}
    </div>
</div>

<aside class="sidebar">
    <div class="logo">
        <img src="{% static 'main/img/medlink.png' %}" alt="MedLink Logo">
    </div>
    <nav>
        <ul>
            <li><a href="{% url 'admin_dashboard' %}">Dashboard</a></li>
            <li><a href="{% url 'user_management' %}">Users</a></li>
            <li><a href="{% url 'patient_records_list' %}">Record Logs</a></li>
            <li><a href="{% url 'appointment_list' %}">Appointments</a></li>
            <li><a 
                href="{% url 'logout' %}" 
                onclick="return confirm('Are you sure you want to log out of the system?');"
                class="logout-link"
            >
                <i class="fas fa-sign-out-alt"></i> Logout
            </a></li>
        </ul>
    </nav>
</aside>

<main class="content">
    <h1 class="page-title">
        Dashboard Overview
        <span class="status-tag">Superadmin</span>
    </h1>

    <section class="top-row">
        <div class="stat-card">
            <img class="icon" src="{% static 'main/img/stet.png' %}" alt="Doctors">
            <h3>Doctors Online</h3>
            <div class="stat-number">{{ active_doctors }} / {{ total_doctors }}</div>
            <p class="stat-desc">Currently marked "Is In"</p>
        </div>
        <div class="stat-card">
            <img class="icon" src="{% static 'main/img/request.png' %}" alt="Requests">
            <h3>Pending Requests</h3>
            <div class="stat-number">{{ pending_appointments }}</div>
            <p class="stat-desc">Awaiting your approval</p>
        </div>
        <div class="stat-card">
            <img class="icon" src="{% static 'main/img/patient.png' %}" alt="Patients">
            <h3>Total Patients</h3>
            <div class="stat-number">{{ total_patients }}</div>
            <p class="stat-desc">Registered users</p>
        </div>
        <div class="stat-card">
            <img class="icon" src="{% static 'main/img/appointment.png' %}" alt="Appointments">
            <h3>Total Appointments</h3>
            <div class="stat-number">{{ total_appointments }}</div>
            <p class="stat-desc">All time history</p>
        </div>
    </section>

    <section class="wide-card">
        <div class="header-row">
            <h3>Newest Registrations</h3>
            <a href="{% url 'user_management' %}" class="btn-action btn-manage">Manage Users</a>
        </div>
        <table>
            <thead>
                <tr><th>Name</th><th>Email</th><th>Role</th></tr>
            </thead>
            <tbody>
                {% for user in recent_activity %}
                <tr>
                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{% if user.is_doctor %}Doctor{% else %}Patient{% endif %}</td>
                </tr>
                {% empty %}
                <tr><td colspan="3" style="text-align:center;">No recent activity found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="wide-card">
        <div class="header-row">
            <h3>Recent Appointments</h3>
            <a href="{% url 'appointment_list' %}" class="btn-action btn-manage">View All</a>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Patient</th><th>Doctor</th><th>Date</th><th>Status</th><th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for appt in appointments %}
                <tr>
                    <td>{{ appt.first_name }} {{ appt.last_name }}</td>
                    <td>Dr. {{ appt.doctor_name }}</td>
                    <td>{{ appt.appointment_date }}</td>
                    <td>
                        {% if appt.status == 'Pending' %}
                        <span style="background:#fff3cd;color:#856404;padding:4px 8px;border-radius:6px;font-size:0.9em;">Pending</span>
                        {% elif appt.status == 'Approved' %}
                        <span style="background:#d4edda;color:#155724;padding:4px 8px;border-radius:6px;font-size:0.9em;">Approved</span>
                        {% else %}
                        {{ appt.status }}
                        {% endif %}
                    </td>
                    <td>
                        {% if appt.status == 'Approved' %}
                        <a href="{% url 'complete_appointment' appt.id %}" class="btn-action btn-complete">âœ“ Finish</a>
                        {% elif appt.status == 'Pending' %}
                        <a href="{% url 'approve_appointment' appt.id %}" class="btn-action btn-approve">Approve</a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="5" style="text-align:center;">No upcoming appointments.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</main>
{% endblock %}
