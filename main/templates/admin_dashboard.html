{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Admin Dashboard{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'main/css/admin_dashboard.css' %}">
  
  <style>
    /* Quick inline styles to make the dashboard pop */
    .top-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .stat-card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        color: white; /* Make text white for colored cards */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .stat-card h3 { font-size: 14px; opacity: 0.9; margin-bottom: 10px; }
    .stat-number { font-size: 32px; font-weight: bold; }
    .stat-desc { font-size: 12px; opacity: 0.8; margin-top: 5px; }
    
    /* Specific Colors for "Health" Indicators */
    .card-blue { background: linear-gradient(135deg, #007bff, #0056b3); } /* Doctors */
    .card-orange { background: linear-gradient(135deg, #fd7e14, #d35400); } /* Pending - Urgent */
    .card-green { background: linear-gradient(135deg, #28a745, #1e7e34); } /* Patients - Growth */
    .card-purple { background: linear-gradient(135deg, #6f42c1, #4a237e); } /* Total Appts */
  </style>
  
  {% block style %}{% endblock %}
</head>
<body>
  <div class="dashboard-wrap">
    <aside class="sidebar">
      <div class="logo">MedLink</div>
      <nav class="nav">
        <ul>
          <li><a href="{% url 'admin_dashboard' %}">Dashboard</a></li>
          <li><a href="{% url 'user_management' %}">Users</a></li>
          <li><a href="{% url 'patient_records_list' %}">Record Logs</a></li>
          <li><a href="{% url 'appointment_list' %}">Appointments</a></li>
          <li><a href="{% url 'logout' %}">Logout</a></li>
        </ul>
      </nav>
    </aside>

    <main class="content">
      {% block content %}
      <h1 class="page-title">
          Dashboard Overview
      </h1>

      <section class="top-row">
        
        <div class="stat-card card-blue">
          <h3>Doctors Online</h3>
          <div class="stat-number">
             {{ active_doctors }} / {{ total_doctors }}
          </div>
          <p class="stat-desc">Currently marked "Is In"</p>
        </div>

        <div class="stat-card card-orange">
          <h3>Pending Requests</h3>
          <div class="stat-number">{{ pending_appointments }}</div>
          <p class="stat-desc">Awaiting your approval</p>
        </div>

        <div class="stat-card card-green">
          <h3>Total Patients</h3>
          <div class="stat-number">{{ total_patients }}</div>
          <p class="stat-desc">Registered users</p>
        </div>

        <div class="stat-card card-purple">
          <h3>Total Appointments</h3>
          <div class="stat-number">{{ total_appointments }}</div>
          <p class="stat-desc">All time history</p>
        </div>
      </section>

      <section class="wide-card">
        <div class="card full">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <h3>Newest Registrations</h3>
              <a href="{% url 'user_management' %}" class="btn">Manage Users</a>
          </div>
          
          <table style="width: 100%; margin-top: 10px; border-collapse: collapse;">
              <thead>
                  <tr style="text-align: left; color: #666;">
                      <th style="padding: 10px;">Name</th>
                      <th>Email</th>
                      <th>Role</th>
                      </tr>
              </thead>
              <tbody>
                  {% for user in recent_activity %}
                  <tr style="border-top: 1px solid #eee;">
                      <td style="padding: 10px;">{{ user.first_name }} {{ user.last_name }}</td>
                      <td>{{ user.email }}</td>
                      <td>
                          {% if user.is_doctor %} <span style="color:blue; font-weight:bold;">Doctor</span>
                          {% else %} Patient {% endif %}
                      </td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="3" style="padding:15px; text-align:center;">No recent activity found.</td></tr>
                  {% endfor %}
              </tbody>
          </table>
        </div>
      </section>

      <section class="wide-card" style="margin-top: 40px;">
        <div class="card full">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <h3>Recent Appointments</h3>
              <a href="{% url 'appointment_list' %}" class="btn">View All</a>
          </div>

          <table class="appointments-table" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <tr style="border-bottom: 2px solid #ddd;">
              <th style="padding: 8px; text-align: left;">Patient</th>
              <th style="padding: 8px; text-align: left;">Doctor</th>
              <th style="padding: 8px; text-align: left;">Date</th>
              <th style="padding: 8px; text-align: left;">Status</th>
              <th style="padding: 8px; text-align: left;">Action</th>
            </tr>

            {% for appt in appointments %}
            <tr style="border-bottom: 1px solid #eee;">
              <td style="padding: 8px;">{{ appt.first_name }} {{ appt.last_name }}</td>
              <td style="padding: 8px;">Dr. {{ appt.doctor_name }}</td>
              <td style="padding: 8px;">{{ appt.appointment_date }}</td>
              
              <td style="padding: 8px;">
                {% if appt.status == 'Pending' %}
                    <span style="background:#fff3cd; color:#856404; padding:2px 6px; border-radius:4px; font-size:0.9em;">Pending</span>
                {% elif appt.status == 'Approved' %}
                    <span style="background:#d4edda; color:#155724; padding:2px 6px; border-radius:4px; font-size:0.9em;">Approved</span>
                {% else %}
                    {{ appt.status }}
                {% endif %}
              </td>

              <td style="padding: 8px;">
                {% if appt.status == 'Approved' %}
                    <a href="{% url 'complete_appointment' appt.id %}" 
                       class="btn-complete"
                       onclick="return confirm('Mark this appointment as fully complete?')"
                       style="background-color: #28a745; color: white; padding: 4px 8px; text-decoration: none; border-radius: 4px; font-size: 12px;">
                       âœ“ Finish
                    </a>
                {% elif appt.status == 'Pending' %}
                    <a href="{% url 'approve_appointment' appt.id %}" style="color: blue; font-weight:bold;">Approve</a>
                {% endif %}
              </td>
            </tr>
            {% empty %}
             <tr><td colspan="5" style="text-align:center; padding: 20px;">No upcoming appointments.</td></tr>
            {% endfor %}
          </table>

        </div>
      </section>

      {% endblock %}
    </main>
  </div>
</body>
</html>